---
kind: Deployment
apiVersion: apps/v1
metadata:
  name: t5gweb
  namespace: t5g-web
spec:
  replicas: 1
  selector:
    matchLabels:
      app: t5gweb
  template:
    metadata:
      labels:
        app: t5gweb
    spec:
      containers:
      - name: celery
        image: image-registry.openshift-image-registry.svc.cluster.local:5000/devt5gweb/devt5gweb:latest
        imagePullPolicy: Always
        command: [
          "/bin/sh",
          "-c",
          "celery -A t5gweb.taskmgr worker -B -s /celery/tasks",
          ]
        env:
        - name: offline_token
          value: OFFLINE_TOKEN
        - name: jira_pass
          value: JIRA_PASS
        - name: bz_key
          value: BZ_KEY
        - name: telco_team
          value: TELCO_TEAM
        - name: telco_email
          value: TELCO_EMAIL
        - name: cnv_team
          value: CNV_TEAM
        - name: cnv_email
          value: CNV_EMAIL
        - name: alert_email
          value: ALERT_EMAIL
        - name: slack_token
          value: SLACK_TOKEN
        - name: slack_channel
          value: SLACK_CHANNEL
        - name: max_to_create
          value: 10
        volumeMounts:
        - mountPath: /celery
          name: task-vol
      - name: t5gweb
        image: image-registry.openshift-image-registry.svc.cluster.local:5000/devt5gweb/devt5gweb:latest
        imagePullPolicy: Always
        command: [
          "/bin/sh",
          "-c",
          "gunicorn --bind 0.0.0.0:8080 --timeout 1200 wsgi:app",
          ]
        env:
        - name: offline_token
          value: OFFLINE_TOKEN
        - name: jira_pass
          value: JIRA_PASS
        - name: bz_key
          value: BZ_KEY
      volumes:
      - name: task-vol
        emptyDir: {}
